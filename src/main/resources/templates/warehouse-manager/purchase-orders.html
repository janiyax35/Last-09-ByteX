<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{warehouse-manager/layout :: (html(content = ~{::content}))}">
<head>
    <title>Manage Purchase Orders</title>
</head>
<body>
<div th:fragment="content">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Manage Purchase Orders</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
            <a th:href="@{/warehouse-manager/purchase-orders/new}" class="btn btn-sm btn-outline-secondary">
                <i class="fas fa-plus"></i> Create New PO
            </a>
        </div>
    </div>

    <!-- Success/Error Messages -->
    <div th:if="${successMessage}" class="alert alert-success" role="alert" th:text="${successMessage}"></div>

    <div class="card" data-aos="fade-up">
        <div class="card-header">
            Purchase Order History
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                    <tr>
                        <th>PO ID</th>
                        <th>Supplier</th>
                        <th>Order Date</th>
                        <th>Total Amount</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="po : ${purchaseOrders}">
                        <td th:text="${po.id}">1</td>
                        <td th:text="${po.supplier.name}">TechSupplies Inc.</td>
                        <td th:text="${#temporals.format(po.orderDate, 'yyyy-MM-dd')}">2023-10-27</td>
                        <td th:text="${'$' + #numbers.formatDecimal(po.totalAmount, 1, 2)}">$1500.00</td>
                        <td>
                            <span class="badge"
                                  th:classappend="${#strings.toString(po.status) == 'PENDING'} ? 'bg-secondary' :
                                                 (${#strings.toString(po.status) == 'APPROVED'} ? 'bg-info text-dark' :
                                                 (${#strings.toString(po.status) == 'SHIPPED'} ? 'bg-primary' :
                                                 (${#strings.toString(po.status) == 'DELIVERED'} ? 'bg-success' : 'bg-danger')))"
                                  th:text="${po.status.name().replace('_', ' ')}">
                                DELIVERED
                            </span>
                        </td>
                        <td>
                            <!-- Dropdown for status update -->
                            <div class="dropdown" th:if="${po.status.name() != 'DELIVERED' && po.status.name() != 'CANCELLED'}">
                                <button class="btn btn-sm btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                                    Update Status
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                    <li th:each="s : ${T(com.bytex.customercaresystem.models.enums.PurchaseOrderStatus).values()}">
                                        <form th:action="@{/warehouse-manager/purchase-orders/update-status/{id}(id=${po.id})}" method="post">
                                             <input type="hidden" name="status" th:value="${s}" />
                                             <button type="submit" class="dropdown-item" th:text="${s.name().replace('_', ' ')}"></button>
                                        </form>
                                    </li>
                                </ul>
                            </div>
                            <span th:if="${po.status.name() == 'DELIVERED' || po.status.name() == 'CANCELLED'}" class="text-muted">Completed</span>
                        </td>
                    </tr>
                     <tr th:if="${#lists.isEmpty(purchaseOrders)}">
                        <td colspan="6" class="text-center">No purchase orders found.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
</body>
</html>